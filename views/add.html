<!--{{ extend './layout/main.html'}}-->

<!--{{block 'content'}}-->



<!--{{/block}}-->

{{extend './layout/main.html'}}<!--继承-->

{{block 'context' }}<!--填坑-->
<style type="text/css">
    #box {
        position: relative;
        background-color: rgba(0, 0, 0, 0.2);
        width: 300px;
        height: 360px;
        margin-top: 10px;
        overflow: hidden;
        padding: 0;
    }

    #box p {
        padding: 0 15px;
    }

    #lrc {
        width: 100%;
        margin-top: 130px;
        position: absolute;
        text-align: center;
        padding-top: 60px;
    }

    .gl {
        color: hotpink;
        background-color: red;
    }
</style>


<div class="container">
    <form id="form" method="post" action="/">
        <div class="form-group">
            <label for="title">歌曲标题</label>
            <input type="text" id="title" name="title" class="form-control" placeholder="请输入歌曲标题">
        </div>
        <div class="form-group">
            <label for="time">歌曲时长</label>
            <input type="text" id="time" name="time" class="form-control" placeholder="请输入歌曲时长">
        </div>
        <div class="form-group">
            <label for="singer">歌手</label>
            <input type="text" id="singer" name="singer" class="form-control" placeholder="请输入歌手姓名">
        </div>
        <div class="form-group">
            <label for="file">歌曲文件</label>
            <input type="file" id="file" name="file">
            <p class="help-block">请上传歌曲文件.</p>
        </div>
        <div class="form-group">
            <label for="filelrc">歌词文件</label>
            <input type="file" id="filelrc" name="filelrc">
            <p class="help-block">请上传歌词文件.</p>
        </div>
        <button type="submit" class="btn btn-success">点击添加</button>
    </form>
</div>

<script>
$('#form').on('submit',function (e) {
e.preventDefault();
// 创建数据载体
var fd = new FormData();
var inputs = document.querySelectorAll('input');
fd.append('title',inputs[0].value);
fd.append('time',inputs[1].value);
fd.append('singer',inputs[2].value);
// type="file" value就是文件的路径
fd.append('file',inputs[3].files[0]);
fd.append('filelrc',inputs[4].files[0]);

    // 发起请求
    $.ajax({
        type:'post',
        url:'/music/add-music',
        data:fd,
        // jquery.js:8970 Uncaught TypeError: Illegal invocation

        processData:false, // 不需要转数据
        contentType:false, // 不需要设置content-type
        dataType:'json',
        success:function (data) {
        if (data.code === '001') {
        if(confirm('添加成功!是否去听歌?')) {
            location.href = '/music/index';
            }
        } else {
            alert(data.msg);
            }
        }
    })

});
</script>

{{/block}}
